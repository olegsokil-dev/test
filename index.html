<!doctype html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diffie-Hellman - –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á B</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 32px;
        margin-bottom: 10px;
      }

      .status {
        display: inline-block;
        padding: 10px 20px;
        border-radius: 25px;
        font-size: 14px;
        font-weight: bold;
        margin-top: 10px;
      }

      .status.connected {
        background: #10b981;
      }

      .status.disconnected {
        background: #ef4444;
      }

      .content {
        padding: 30px;
      }

      /* –ö—Ä–æ–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—É */
      .steps-container {
        display: grid;
        gap: 20px;
        margin-bottom: 30px;
      }

      .step {
        background: #f9fafb;
        padding: 20px;
        border-radius: 10px;
        border-left: 5px solid #d1d5db;
        transition: all 0.3s;
        opacity: 0.5;
      }

      .step.active {
        border-left-color: #667eea;
        background: #ede9fe;
        opacity: 1;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
      }

      .step.completed {
        border-left-color: #10b981;
        background: #d1fae5;
        opacity: 1;
      }

      .step-header {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }

      .step-number {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #d1d5db;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-right: 10px;
        transition: all 0.3s;
      }

      .step.active .step-number {
        background: #667eea;
        transform: scale(1.2);
      }

      .step.completed .step-number {
        background: #10b981;
      }

      .step-title {
        font-size: 18px;
        font-weight: bold;
        color: #374151;
      }

      .step-content {
        margin-left: 40px;
        color: #6b7280;
        font-size: 14px;
      }

      .step-data {
        margin-top: 10px;
        padding: 10px;
        background: white;
        border-radius: 5px;
        font-family: 'Courier New', monospace;
        word-break: break-all;
      }

      .section {
        background: #f9fafb;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
      }

      .section h2 {
        color: #374151;
        margin-bottom: 15px;
        font-size: 20px;
      }

      .params {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 15px 0;
      }

      .param-item {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #667eea;
      }

      .param-label {
        font-size: 12px;
        color: #6b7280;
        margin-bottom: 5px;
      }

      .param-value {
        font-size: 18px;
        font-weight: bold;
        color: #1f2937;
        word-break: break-all;
      }

      .secret {
        background: #fef3c7;
        border-left-color: #f59e0b;
      }

      .shared-secret {
        background: #d1fae5;
        border-left-color: #10b981;
        font-size: 24px;
        text-align: center;
        padding: 20px;
      }

      .buttons {
        display: flex;
        gap: 15px;
        margin-top: 20px;
      }

      button {
        flex: 1;
        padding: 15px 30px;
        font-size: 16px;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      button:not(:disabled):hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .btn-primary {
        background: #667eea;
        color: white;
      }

      .btn-success {
        background: #10b981;
        color: white;
      }

      .btn-secondary {
        background: #6b7280;
        color: white;
      }

      .log-section {
        background: #1f2937;
        color: #f9fafb;
        border-radius: 8px;
        padding: 20px;
        max-height: 400px;
        overflow-y: auto;
        font-family: 'Courier New', monospace;
        font-size: 13px;
      }

      .log-item {
        margin-bottom: 8px;
        padding: 5px 0;
        border-bottom: 1px solid #374151;
        animation: fadeIn 0.3s;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .log-time {
        color: #9ca3af;
        margin-right: 10px;
      }

      .formula {
        background: #f3f4f6;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        text-align: center;
        color: #4b5563;
      }

      .alert {
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        font-weight: 500;
      }

      .alert-success {
        background: #d1fae5;
        color: #065f46;
        border: 2px solid #10b981;
      }

      .alert-error {
        background: #fee2e2;
        color: #991b1b;
        border: 2px solid #ef4444;
      }

      .primes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 10px;
        margin: 15px 0;
      }

      .prime-item {
        background: white;
        padding: 10px;
        border-radius: 5px;
        text-align: center;
        border: 2px solid #667eea;
      }

      .prime-number {
        font-size: 18px;
        font-weight: bold;
        color: #667eea;
      }

      .prime-attempts {
        font-size: 12px;
        color: #6b7280;
        margin-top: 5px;
      }

      .alert-info {
        background: #dbeafe;
        color: #1e40af;
        border: 2px solid #3b82f6;
      }

      .theory-section {
        background: #f0fdf4;
        border: 2px solid #10b981;
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
      }

      .theory-section h3 {
        color: #065f46;
        margin-bottom: 10px;
      }

      .theory-section p {
        color: #047857;
        line-height: 1.6;
        margin: 10px 0;
      }

      .formula-box {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid #10b981;
        font-family: 'Courier New', monospace;
      }

      .info-box {
        background: #fff7ed;
        border: 2px solid #f59e0b;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
      }

      .info-box h4 {
        color: #92400e;
        margin-bottom: 8px;
      }

      .info-box p {
        color: #78350f;
        line-height: 1.5;
      }

      .collapsible {
        cursor: pointer;
        padding: 15px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 8px;
        text-align: left;
        width: 100%;
        font-size: 16px;
        font-weight: bold;
        margin: 10px 0;
      }

      .collapsible:hover {
        background: #5568d3;
      }

      .collapsible-content {
        display: none;
        padding: 15px;
        background: #f9fafb;
        border-radius: 8px;
        margin-bottom: 10px;
      }

      .collapsible-content.active {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üîê –ü—Ä–æ—Ç–æ–∫–æ–ª –î—ñ—Ñ—Ñ—ñ-–•–µ–ª–º–∞–Ω–∞</h1>
        <h2>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á B (–ö–ª—ñ—î–Ω—Ç)</h2>
        <div class="status disconnected" id="status">üî¥ –í—ñ–¥–∫–ª—é—á–µ–Ω–æ</div>
      </div>

      <div class="content">
        <!-- –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞ -->
        <button class="collapsible" onclick="toggleSection('theory')">
          üìö –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞ (–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å —â–æ–± —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∏)
        </button>
        <div class="collapsible-content" id="theory">
          <div class="theory-section">
            <h3>üî¢ 1. –¢–µ—Å—Ç –§–µ—Ä–º–∞ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–æ—Å—Ç–æ—Ç–∏</h3>
            <p>
              <strong>–ú–∞–ª–∞ —Ç–µ–æ—Ä–µ–º–∞ –§–µ—Ä–º–∞:</strong> –Ø–∫—â–æ p - –ø—Ä–æ—Å—Ç–µ —á–∏—Å–ª–æ, –∞ a - —Ü—ñ–ª–µ —á–∏—Å–ª–æ, –Ω–µ –∫—Ä–∞—Ç–Ω–µ p, —Ç–æ:
            </p>
            <div class="formula-box">
              a^(p-1) ‚â° 1 (mod p)
            </div>
            <p>
              <strong>–Ø–∫ –ø—Ä–∞—Ü—é—î —Ç–µ—Å—Ç:</strong><br>
              1. –í–∏–±–∏—Ä–∞—î–º–æ –≤–∏–ø–∞–¥–∫–æ–≤–µ —á–∏—Å–ª–æ a –≤ –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ [2, p-2]<br>
              2. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –ù–°–î(a, p) = 1<br>
              3. –û–±—á–∏—Å–ª—é—î–º–æ a^(p-1) mod p<br>
              4. –Ø–∫—â–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 1, —Ç–æ p - —Å–∫–ª–∞–¥–µ–Ω–µ —á–∏—Å–ª–æ<br>
              5. –ü–æ–≤—Ç–æ—Ä—é—î–º–æ k —Ä–∞–∑—ñ–≤ (—É –Ω–∞—à–æ–º—É –≤–∏–ø–∞–¥–∫—É k=4)
            </p>
            <p>
              <strong>–í–∞–∂–ª–∏–≤–æ:</strong> –Ø–∫—â–æ —á–∏—Å–ª–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Ç–µ—Å—Ç k —Ä–∞–∑—ñ–≤, –≤–æ–Ω–æ —î –ø—Ä–æ—Å—Ç–∏–º –∑ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—é –Ω–µ –º–µ–Ω—à–µ 1 - (1/2)^k.
              –ü—Ä–∏ k=4 –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å –ø–æ–º–∏–ª–∫–∏ ‚â§ 6.25%.
            </p>
          </div>

          <div class="theory-section">
            <h3>üåø 2. –ü—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–π –∫–æ—Ä—ñ–Ω—å (Primitive Root)</h3>
            <p>
              <strong>–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è:</strong> –ß–∏—Å–ª–æ Œ± –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–º –∫–æ—Ä–µ–Ω–µ–º –ø–æ –º–æ–¥—É–ª—é p, —è–∫—â–æ Œ± –≥–µ–Ω–µ—Ä—É—î –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –º—É–ª—å—Ç–∏–ø–ª—ñ–∫–∞—Ç–∏–≤–Ω–æ—ó –≥—Ä—É–ø–∏ Z*_p.
            </p>
            <p>
              <strong>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–æ—Å—Ç—ñ:</strong> Œ± —î –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–º –∫–æ—Ä–µ–Ω–µ–º mod p, —è–∫—â–æ –¥–ª—è –≤—Å—ñ—Ö –ø—Ä–æ—Å—Ç–∏—Ö –¥—ñ–ª—å–Ω–∏–∫—ñ–≤ q —á–∏—Å–ª–∞ (p-1):
            </p>
            <div class="formula-box">
              Œ±^((p-1)/q) ‚â¢ 1 (mod p)
            </div>
            <p>
              <strong>–ß–æ–º—É —Ü–µ –≤–∞–∂–ª–∏–≤–æ –¥–ª—è –î—ñ—Ñ—Ñ—ñ-–•–µ–ª–º–∞–Ω–∞?</strong><br>
              –ü—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–π –∫–æ—Ä—ñ–Ω—å –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –≤—Å—ñ –º–æ–∂–ª–∏–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É –±–µ–∑–ø–µ–∫—É –ø—Ä–æ—Ç–æ–∫–æ–ª—É.
            </p>
          </div>

          <div class="theory-section">
            <h3>üîê 3. –ü—Ä–æ—Ç–æ–∫–æ–ª –î—ñ—Ñ—Ñ—ñ-–•–µ–ª–º–∞–Ω–∞</h3>
            <p>
              <strong>–ú–µ—Ç–∞:</strong> –î–≤–∞ –∞–±–æ–Ω–µ–Ω—Ç–∏ (A —ñ B) —Å—Ç–≤–æ—Ä—é—é—Ç—å —Å–ø—ñ–ª—å–Ω–∏–π —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á –ø–æ –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –∫–∞–Ω–∞–ª—É –∑–≤'—è–∑–∫—É.
            </p>
            <p><strong>–ö—Ä–æ–∫ 1 - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤:</strong></p>
            <div class="formula-box">
              p - –≤–µ–ª–∏–∫–µ –ø—Ä–æ—Å—Ç–µ —á–∏—Å–ª–æ (—É –Ω–∞—Å –∑ [5000, 10000])<br>
              Œ± - –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–π –∫–æ—Ä—ñ–Ω—å –ø–æ –º–æ–¥—É–ª—é p
            </div>
            <p><strong>–ö—Ä–æ–∫ 2 - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–µ–∫—Ä–µ—Ç–Ω–∏—Ö –∫–ª—é—á—ñ–≤:</strong></p>
            <div class="formula-box">
              K_A - —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á –∞–±–æ–Ω–µ–Ω—Ç–∞ A (–≤–∏–ø–∞–¥–∫–æ–≤–µ —á–∏—Å–ª–æ: 2 ‚â§ K_A ‚â§ p-2)<br>
              K_B - —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á –∞–±–æ–Ω–µ–Ω—Ç–∞ B (–≤–∏–ø–∞–¥–∫–æ–≤–µ —á–∏—Å–ª–æ: 2 ‚â§ K_B ‚â§ p-2)
            </div>
            <p><strong>–ö—Ä–æ–∫ 3 - –û–±—á–∏—Å–ª–µ–Ω–Ω—è –ø—É–±–ª—ñ—á–Ω–∏—Ö –∫–ª—é—á—ñ–≤:</strong></p>
            <div class="formula-box">
              Y_A = Œ±^K_A mod p<br>
              Y_B = Œ±^K_B mod p
            </div>
            <p><strong>–ö—Ä–æ–∫ 4 - –û–±–º—ñ–Ω –ø—É–±–ª—ñ—á–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏ —Ç–∞ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —Å–ø—ñ–ª—å–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç—É:</strong></p>
            <div class="formula-box">
              K_AB = Y_B^K_A mod p = Y_A^K_B mod p = Œ±^(K_A * K_B) mod p
            </div>
            <p>
              <strong>–ë–µ–∑–ø–µ–∫–∞:</strong> –ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –±–∞—á–∏—Ç—å p, Œ±, Y_A, Y_B, –∞–ª–µ –Ω–µ –º–æ–∂–µ –æ–±—á–∏—Å–ª–∏—Ç–∏ K_AB –±–µ–∑ –∑–Ω–∞–Ω–Ω—è K_A –∞–±–æ K_B 
            </p>
          </div>

          <div class="theory-section">
            <h3>üìä 4. –°–µ—Ä–µ–¥–Ω—è –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–± –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø—Ä–æ—Å—Ç–æ–≥–æ —á–∏—Å–ª–∞</h3>
            <p>
              –ó–≥—ñ–¥–Ω–æ –∑ —Ç–µ–æ—Ä–µ–º–æ—é –ø—Ä–æ —Ä–æ–∑–ø–æ–¥—ñ–ª –ø—Ä–æ—Å—Ç–∏—Ö —á–∏—Å–µ–ª, —ñ–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ –≤–∏–ø–∞–¥–∫–æ–≤–µ —á–∏—Å–ª–æ n —î –ø—Ä–æ—Å—Ç–∏–º, –ø—Ä–∏–±–ª–∏–∑–Ω–æ –¥–æ—Ä—ñ–≤–Ω—é—î 1/ln(n).
            </p>
            <p>
              –î–ª—è —á–∏—Å–µ–ª –∑ –¥—ñ–∞–ø–∞–∑–æ–Ω—É [5000, 10000] —Å–µ—Ä–µ–¥–Ω—è –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å ‚âà 1/ln(7500) ‚âà 1/8.9 ‚âà 11%.
            </p>
            <p>
              <strong>–û—á—ñ–∫—É–≤–∞–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±:</strong> –ø—Ä–∏–±–ª–∏–∑–Ω–æ 9-11 —Å–ø—Ä–æ–± –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —á–∏—Å–ª–∞.
            </p>
          </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è -->
        <div class="buttons">
          <button
            class="btn-primary"
            onclick="initiateProtocol()"
            id="btn-init"
          >
            üöÄ –ü–æ—á–∞—Ç–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª
          </button>
          <button
            class="btn-success"
            onclick="sendPublicKey()"
            id="btn-send"
            disabled
          >
            üì§ –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ Y_B
          </button>
          <button class="btn-primary" onclick="generate10Primes()">
            üî¢ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ 10 –ø—Ä–æ—Å—Ç–∏—Ö
          </button>
          <button class="btn-secondary" onclick="clearAll()">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏
          </button>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ -->
        <div id="verification-result"></div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó 10 –ø—Ä–æ—Å—Ç–∏—Ö -->
        <div id="primes-result"></div>

        <!-- –ö—Ä–æ–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—É -->
        <div class="steps-container">
          <!-- –ö—Ä–æ–∫ 1 -->
          <div class="step" id="step-1">
            <div class="step-header">
              <div class="step-number">1</div>
              <div class="step-title">
                –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á A)
              </div>
            </div>
            <div class="step-content">
              –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º A —á–µ—Ä–µ–∑ WebSocket
              <div class="step-data" id="step-1-data"></div>
            </div>
          </div>

          <!-- –ö—Ä–æ–∫ 2 -->
          <div class="step" id="step-2">
            <div class="step-header">
              <div class="step-number">2</div>
              <div class="step-title">–û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤</div>
            </div>
            <div class="step-content">
              –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á A –Ω–∞–¥—Å–∏–ª–∞—î: –ø—Ä–æ—Å—Ç–µ —á–∏—Å–ª–æ p, –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç Œ±,
              –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á Y_A
              <div class="info-box">
                <h4>üí° –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:</h4>
                <p>‚Ä¢ <strong>p</strong> –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–µ —Ç–µ—Å—Ç–æ–º –§–µ—Ä–º–∞ (k=4) –∑ –¥—ñ–∞–ø–∞–∑–æ–Ω—É [5000, 10000]</p>
                <p>‚Ä¢ <strong>Œ±</strong> - –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–π –∫–æ—Ä—ñ–Ω—å mod p (–ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ, —â–æ Œ±^((p-1)/q) ‚â¢ 1 –¥–ª—è –≤—Å—ñ—Ö –ø—Ä–æ—Å—Ç–∏—Ö q|(p-1))</p>
                <p>‚Ä¢ <strong>Y_A</strong> = Œ±^K_A mod p (–ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ A)</p>
              </div>
              <div class="step-data" id="step-2-data"></div>
            </div>
          </div>

          <!-- –ö—Ä–æ–∫ 3 -->
          <div class="step" id="step-3">
            <div class="step-header">
              <div class="step-number">3</div>
              <div class="step-title">–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ B</div>
            </div>
            <div class="step-content">
              –í–∏–ø–∞–¥–∫–æ–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ k_B (2 ‚â§ k_B ‚â§ p-2)
              <div class="info-box">
                <h4>üí° –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:</h4>
                <p>–ì–µ–Ω–µ—Ä—É—î–º–æ –≤–∏–ø–∞–¥–∫–æ–≤–∏–π —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á k_B. –¶–µ–π –∫–ª—é—á –ù–Ü–ö–û–õ–ò –Ω–µ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –ø–æ –º–µ—Ä–µ–∂—ñ —ñ –≤—ñ–¥–æ–º–∏–π –ª–∏—à–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É B.</p>
                <p>–û–±–º–µ–∂–µ–Ω–Ω—è: 2 ‚â§ k_B ‚â§ p-2</p>
              </div>
              <div class="step-data" id="step-3-data"></div>
            </div>
          </div>

          <!-- –ö—Ä–æ–∫ 4 -->
          <div class="step" id="step-4">
            <div class="step-header">
              <div class="step-number">4</div>
              <div class="step-title">–û–±—á–∏—Å–ª–µ–Ω–Ω—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –∫–ª—é—á–∞ B</div>
            </div>
            <div class="step-content">
              –û–±—á–∏—Å–ª–µ–Ω–Ω—è Y_B = Œ±^k_B mod p
              <div class="info-box">
                <h4>üí° –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:</h4>
                <p>–û–±—á–∏—Å–ª—é—î–º–æ –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á Y_B –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–æ–¥—É–ª—å–Ω–µ –ø—ñ–¥–Ω–µ—Å–µ–Ω–Ω—è –¥–æ —Å—Ç–µ–ø–µ–Ω—è.</p>
                <p>–¶–µ–π –∫–ª—é—á –ë–£–î–ï –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É A –ø–æ –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –∫–∞–Ω–∞–ª—É.</p>
                <p>–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫, —è–∫–∏–π –ø–æ–±–∞—á–∏—Ç—å Y_B, –Ω–µ –∑–º–æ–∂–µ –æ–±—á–∏—Å–ª–∏—Ç–∏ k_B (–ø—Ä–æ–±–ª–µ–º–∞ –¥–∏—Å–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª–æ–≥–∞—Ä–∏—Ñ–º—É).</p>
              </div>
              <div class="formula" id="step-4-formula"></div>
              <div class="step-data" id="step-4-data"></div>
            </div>
          </div>

          <!-- –ö—Ä–æ–∫ 5 -->
          <div class="step" id="step-5">
            <div class="step-header">
              <div class="step-number">5</div>
              <div class="step-title">–û–±—á–∏—Å–ª–µ–Ω–Ω—è —Å–ø—ñ–ª—å–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç—É</div>
            </div>
            <div class="step-content">
              –û–±—á–∏—Å–ª–µ–Ω–Ω—è K_AB = Y_A^k_B mod p
              <div class="info-box">
                <h4>üí° –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:</h4>
                <p>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –æ—Ç—Ä–∏–º–∞–Ω–∏–π –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á Y_A –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ A —Ç–∞ –Ω–∞—à —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á k_B.</p>
                <p><strong>–ú–∞–≥—ñ—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ—ñ—ó:</strong><br>
                K_AB (–≤—ñ–¥ B) = Y_A^k_B mod p = (Œ±^K_A)^k_B mod p = Œ±^(K_A¬∑k_B) mod p<br>
                K_AB (–≤—ñ–¥ A) = Y_B^K_A mod p = (Œ±^k_B)^K_A mod p = Œ±^(K_A¬∑k_B) mod p</p>
                <p>–û–±–∏–¥–≤–∞ –∞–±–æ–Ω–µ–Ω—Ç–∏ –æ—Ç—Ä–∏–º–∞—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!</p>
              </div>
              <div class="formula" id="step-5-formula"></div>
              <div class="step-data" id="step-5-data"></div>
            </div>
          </div>

          <!-- –ö—Ä–æ–∫ 6 -->
          <div class="step" id="step-6">
            <div class="step-header">
              <div class="step-number">6</div>
              <div class="step-title">
                –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É A
              </div>
            </div>
            <div class="step-content">
              –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è Y_B –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É A –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ K_AB = Y_A^k_B mod p
              <div class="step-data" id="step-6-data"></div>
            </div>
          </div>

          <!-- –ö—Ä–æ–∫ 7 -->
          <div class="step" id="step-7">
            <div class="step-header">
              <div class="step-number">7</div>
              <div class="step-title">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–ø—ñ–ª—å–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç—É</div>
            </div>
            <div class="step-content">
              –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –æ–±—á–∏—Å–ª–µ–Ω–∏—Ö —Å–ø—ñ–ª—å–Ω–∏—Ö —Å–µ–∫—Ä–µ—Ç—ñ–≤ –≤—ñ–¥ A —Ç–∞ B
              <div class="info-box">
                <h4>üí° –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:</h4>
                <p>–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å –æ–±—á–∏—Å–ª–µ–Ω—ñ —Å–ø—ñ–ª—å–Ω—ñ —Å–µ–∫—Ä–µ—Ç–∏.</p>
                <p><strong>–Ø–∫—â–æ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å:</strong> –ü—Ä–æ—Ç–æ–∫–æ–ª –≤–∏–∫–æ–Ω–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ! –û–±–∏–¥–≤–∞ –∞–±–æ–Ω–µ–Ω—Ç–∏ –º–∞—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤–∏–π —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á K_AB, —è–∫–∏–π –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è.</p>
                <p><strong>–í–∞–∂–ª–∏–≤–æ:</strong> –ù—ñ—Ö—Ç–æ, –æ–∫—Ä—ñ–º A —ñ B, –Ω–µ –∑–º—ñ–≥ –æ–±—á–∏—Å–ª–∏—Ç–∏ K_AB, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –ø—ñ–¥—Å–ª—É—Ö–æ–≤—É–≤–∞–≤ –≤–µ—Å—å –æ–±–º—ñ–Ω!</p>
              </div>
              <div class="step-data" id="step-7-data"></div>
            </div>
          </div>
        </div>

        <!-- –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è -->
        <div class="section">
          <h2>üìä –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h2>
          <div class="params">
            <div class="param-item">
              <div class="param-label">–ü—Ä–æ—Å—Ç–µ —á–∏—Å–ª–æ (p)</div>
              <div class="param-value" id="param-p">‚Äî</div>
            </div>
            <div class="param-item">
              <div class="param-label">–ü—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç (Œ±)</div>
              <div class="param-value" id="param-alpha">‚Äî</div>
            </div>
            <div class="param-item">
              <div class="param-label">–ü—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á A (Y_A)</div>
              <div class="param-value" id="param-ya">‚Äî</div>
            </div>
            <div class="param-item">
              <div class="param-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–± –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∫–ª—é—á:</div>
              <div class="param-value" id="param-attempts">‚Äî</div>
            </div>
            <div class="param-item secret">
              <div class="param-label">üîê –°–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á B (k_B)</div>
              <div class="param-value" id="param-kb">‚Äî</div>
            </div>
            <div class="param-item">
              <div class="param-label">–ü—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á B (Y_B)</div>
              <div class="param-value" id="param-yb">‚Äî</div>
            </div>
            <div class="param-item shared-secret">
              <div class="param-label">üíé –°–ø—ñ–ª—å–Ω–∏–π —Å–µ–∫—Ä–µ—Ç (K_AB)</div>
              <div class="param-value" id="shared-secret">‚Äî</div>
            </div>
          </div>
        </div>

        <!-- –õ–æ–≥ -->
        <div class="section">
          <h2>üìã –õ–æ–≥ –ø–æ–¥—ñ–π</h2>
          <div class="log-section" id="log"></div>
        </div>
      </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    <script>
      let socket;
      let serverParams = null;
      let clientSecretKey = null;
      let clientPublicKey = null;
      let currentStep = 0;

      function setStep(stepNumber) {
        currentStep = stepNumber;
        for (let i = 1; i <= 7; i++) {
          const stepEl = document.getElementById(`step-${i}`);
          stepEl.classList.remove('active', 'completed');
          if (i < stepNumber) {
            stepEl.classList.add('completed');
          } else if (i === stepNumber) {
            stepEl.classList.add('active');
          }
        }
      }

      function connectToServer() {
        socket = io('http://localhost:3000');

        socket.on('connect', () => {
          updateStatus(true);
          addLog('‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á A)');
          setStep(1);
          document.getElementById('step-1-data').innerHTML =
            "‚úÖ –ó'—î–¥–Ω–∞–Ω–Ω—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ";
          setTimeout(() => setStep(1), 100);
          document.getElementById('btn-init').disabled = false;
        });

        socket.on('disconnect', () => {
          updateStatus(false);
          addLog('‚ùå –í—ñ–¥–∫–ª—é—á–µ–Ω–æ –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞');
          document.getElementById('btn-init').disabled = false;
          document.getElementById('btn-send').disabled = true;
          setStep(0);
        });

        socket.on('dhParameters', (data) => {
          addLog('üì® –û—Ç—Ä–∏–º–∞–Ω–æ –≤—ñ–¥–∫—Ä–∏—Ç—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ A');
          addLog(`   p = ${data.primeNumber} (–∑–Ω–∞–π–¥–µ–Ω–æ –∑–∞ ${data.attempts} —Å–ø—Ä–æ–±)`);
          addLog(`   Œ± = ${data.alpha} (–ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–π –∫–æ—Ä—ñ–Ω—å mod p)`);
          addLog(`   Y_A = ${data.publicKey}`);

          // –õ–æ–≥—É—î–º–æ —á–∏—Å–ª–∞, —è–∫—ñ –Ω–µ –ø—Ä–æ–π—à–ª–∏ —Ç–µ—Å—Ç
          if (data.failedNumbers && data.failedNumbers.length > 0) {
            addLog('‚ùå –ü—Ä–∏–∫–ª–∞–¥–∏ —á–∏—Å–µ–ª, —â–æ –ù–ï –ø—Ä–æ–π—à–ª–∏ —Ç–µ—Å—Ç –§–µ—Ä–º–∞:');
            data.failedNumbers.forEach((failed) => {
              addLog(`   ${failed.number} - ${failed.reason}`);
            });
          }

          setStep(2);
          let step2Html = `p = ${data.primeNumber}<br>Œ± = ${data.alpha}<br>Y_A = ${data.publicKey}<br>–°–ø—Ä–æ–±: ${data.attempts}`;

          if (data.failedNumbers && data.failedNumbers.length > 0) {
            step2Html += '<br><br><small><strong>–ù–µ –ø—Ä–æ–π—à–ª–∏ —Ç–µ—Å—Ç:</strong><br>';
            data.failedNumbers.forEach((failed) => {
              step2Html += `${failed.number} - ${failed.reason}<br>`;
            });
            step2Html += '</small>';
          }

          document.getElementById('step-2-data').innerHTML = step2Html;

          serverParams = {
            primeNumber: data.primeNumber,
            alpha: data.alpha,
            publicKeyA: data.publicKey,
            attempts: data.attempts,
          };

          displayServerParams(serverParams);
          generateClientKeys(serverParams);
        });

        socket.on('sharedSecretComputed', (data) => {
          addLog('üéâ –û—Ç—Ä–∏–º–∞–Ω–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ A');
          addLog(`üíé –°–ø—ñ–ª—å–Ω–∏–π —Å–µ–∫—Ä–µ—Ç (–≤—ñ–¥ A): ${data.sharedSecret}`);

          setStep(7);
          const localSecret = parseInt(
            document.getElementById('shared-secret').textContent,
          );
          const serverSecret = data.sharedSecret;

          document.getElementById('step-7-data').innerHTML =
            `K_AB (–≤—ñ–¥ B) = ${localSecret}<br>K_AB (–≤—ñ–¥ A) = ${serverSecret}`;

          const verificationDiv = document.getElementById(
            'verification-result',
          );
          if (localSecret === serverSecret) {
            addLog('‚úÖ –£–°–ü–Ü–•! –°–ø—ñ–ª—å–Ω—ñ —Å–µ–∫—Ä–µ—Ç–∏ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å!');
            addLog(`   K_AB = ${localSecret}`);
            verificationDiv.innerHTML =
              '<div class="alert alert-success">‚úÖ –£–°–ü–Ü–•! –°–ø—ñ–ª—å–Ω—ñ —Å–µ–∫—Ä–µ—Ç–∏ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å! –ü—Ä–æ—Ç–æ–∫–æ–ª –î—ñ—Ñ—Ñ—ñ-–•–µ–ª–º–∞–Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ.</div>';
          } else {
            addLog('‚ùå –ü–û–ú–ò–õ–ö–ê! –°–ø—ñ–ª—å–Ω—ñ —Å–µ–∫—Ä–µ—Ç–∏ –ù–ï —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å!');
            addLog(`   K_AB (B) = ${localSecret}`);
            addLog(`   K_AB (A) = ${serverSecret}`);
            verificationDiv.innerHTML =
              '<div class="alert alert-error">‚ùå –ü–û–ú–ò–õ–ö–ê! –°–ø—ñ–ª—å–Ω—ñ —Å–µ–∫—Ä–µ—Ç–∏ –ù–ï —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å!</div>';
          }
        });

        socket.on('error', (error) => {
          addLog('‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞: ' + error.message);
        });

        socket.on('primes10Result', (data) => {
          addLog('üî¢ –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ 10 –ø—Ä–æ—Å—Ç–∏—Ö —á–∏—Å–µ–ª!');
          addLog(`üìä –°–µ—Ä–µ–¥–Ω—è –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±: ${data.averageAttempts.toFixed(2)}`);
          addLog(`üìä –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±: ${data.totalAttempts}`);

          const primesDiv = document.getElementById('primes-result');
          let html = '<div class="alert alert-info">';
          html += `<h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó 10 –ø—Ä–æ—Å—Ç–∏—Ö —á–∏—Å–µ–ª</h3>`;
          html += `<div class="info-box">`;
          html += `<h4>üí° –ü–æ—è—Å–Ω–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤:</h4>`;
          html += `<p>–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —á–∏—Å–ª–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è:</p>`;
          html += `<p>‚Ä¢ <strong>–¢–µ—Å—Ç –§–µ—Ä–º–∞ –∑ k=4:</strong> –ö–æ–∂–Ω–µ –≤–∏–ø–∞–¥–∫–æ–≤–µ —á–∏—Å–ª–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è 4 —Ä–∞–∑–∏</p>`;
          html += `<p>‚Ä¢ <strong>–î—ñ–∞–ø–∞–∑–æ–Ω:</strong> [5000, 10000]</p>`;
          html += `<p>‚Ä¢ <strong>–¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å:</strong> ‚âà 1/ln(7500) ‚âà 11% (–æ—á—ñ–∫—É–≤–∞–Ω–æ ~9 —Å–ø—Ä–æ–±)</p>`;
          html += `<p>‚Ä¢ <strong>–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> ${data.averageAttempts.toFixed(2)} —Å–ø—Ä–æ–± —É —Å–µ—Ä–µ–¥–Ω—å–æ–º—É</p>`;
          html += `</div>`;
          html += `<p><strong>–°–µ—Ä–µ–¥–Ω—è –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±:</strong> ${data.averageAttempts.toFixed(2)}</p>`;
          html += `<p><strong>–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±:</strong> ${data.totalAttempts}</p>`;
          html += '<div class="primes-grid">';

          data.primes.forEach((prime, index) => {
            html += `<div class="prime-item">`;
            html += `<div class="prime-number">${prime}</div>`;
            html += `<div class="prime-attempts">${data.attempts[index]} —Å–ø—Ä–æ–±</div>`;
            html += `</div>`;
          });

          html += '</div>';

          // –î–æ–¥–∞—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —á–∏—Å–ª–∞, —è–∫—ñ –Ω–µ –ø—Ä–æ–π—à–ª–∏ —Ç–µ—Å—Ç
          if (data.failedNumbers && data.failedNumbers.length > 0) {
            html += '<div class="info-box" style="margin-top: 20px;">';
            html += '<h4>‚ùå –ü—Ä–∏–∫–ª–∞–¥–∏ —á–∏—Å–µ–ª, —â–æ –ù–ï –ø—Ä–æ–π—à–ª–∏ —Ç–µ—Å—Ç –§–µ—Ä–º–∞:</h4>';
            html += '<p style="font-size: 12px; font-family: monospace;">';

            data.failedNumbers.forEach((item) => {
              html += `<strong>–î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ #${item.primeIndex}:</strong><br>`;
              item.failures.forEach((failed) => {
                html += `&nbsp;&nbsp;‚Ä¢ ${failed.number} - ${failed.reason}<br>`;
              });
              html += '<br>';
            });

            html += '</p></div>';
          }

          html += '</div>';
          primesDiv.innerHTML = html;

          data.primes.forEach((prime, index) => {
            addLog(`   ${index + 1}. p=${prime} (${data.attempts[index]} —Å–ø—Ä–æ–±)`);
          });

          // –õ–æ–≥—É—î–º–æ –Ω–µ–≤–¥–∞–ª—ñ —Å–ø—Ä–æ–±–∏
          if (data.failedNumbers && data.failedNumbers.length > 0) {
            addLog('‚ùå –ü—Ä–∏–∫–ª–∞–¥–∏ —á–∏—Å–µ–ª, —â–æ –ù–ï –ø—Ä–æ–π—à–ª–∏ —Ç–µ—Å—Ç –§–µ—Ä–º–∞:');
            data.failedNumbers.forEach((item) => {
              addLog(`   –î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ #${item.primeIndex}:`);
              item.failures.forEach((failed) => {
                addLog(`      ${failed.number} - ${failed.reason}`);
              });
            });
          }
        });
      }

      function updateStatus(connected) {
        const statusEl = document.getElementById('status');
        if (connected) {
          statusEl.textContent = 'üü¢ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ';
          statusEl.className = 'status connected';
        } else {
          statusEl.textContent = 'üî¥ –í—ñ–¥–∫–ª—é—á–µ–Ω–æ';
          statusEl.className = 'status disconnected';
        }
      }

      function displayServerParams(data) {
        document.getElementById('param-p').textContent = data.primeNumber;
        document.getElementById('param-alpha').textContent = data.alpha;
        document.getElementById('param-ya').textContent = data.publicKeyA;
        document.getElementById('param-attempts').textContent = data.attempts;
      }

      function initiateProtocol() {
        addLog('üöÄ –Ü–Ω—ñ—Ü—ñ–∞—Ü—ñ—è –ø—Ä–æ—Ç–æ–∫–æ–ª—É –î—ñ—Ñ—Ñ—ñ-–•–µ–ª–º–∞–Ω–∞...');
        socket.emit('initiateDH', { message: '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á B –≥–æ—Ç–æ–≤–∏–π' });
        document.getElementById('btn-init').disabled = true;
        document.getElementById('verification-result').innerHTML = '';
      }

      function generateClientKeys(data) {
        const { primeNumber, alpha, publicKeyA } = data;

        // –ö—Ä–æ–∫ 3: –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
        setStep(3);
        addLog('üîß –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ B...');

        clientSecretKey = Math.floor(Math.random() * (primeNumber - 3)) + 2;
        addLog(`üîê –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á k_B = ${clientSecretKey}`);
        document.getElementById('param-kb').textContent = clientSecretKey;
        document.getElementById('step-3-data').innerHTML =
          `k_B = ${clientSecretKey}`;

        // –ö—Ä–æ–∫ 4: –û–±—á–∏—Å–ª–µ–Ω–Ω—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –∫–ª—é—á–∞ B
        setTimeout(() => {
          setStep(4);
          clientPublicKey = modPow(alpha, clientSecretKey, primeNumber);
          addLog(`üîë –û–±—á–∏—Å–ª–µ–Ω–æ –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á Y_B = Œ±^k_B mod p`);
          addLog(
            `   Y_B = ${alpha}^${clientSecretKey} mod ${primeNumber} = ${clientPublicKey}`,
          );
          document.getElementById('param-yb').textContent = clientPublicKey;
          document.getElementById('step-4-formula').innerHTML =
            `Y_B = ${alpha}^${clientSecretKey} mod ${primeNumber}`;
          document.getElementById('step-4-data').innerHTML =
            `Y_B = ${clientPublicKey}`;

          // –ö—Ä–æ–∫ 5: –û–±—á–∏—Å–ª–µ–Ω–Ω—è —Å–ø—ñ–ª—å–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç—É
          setTimeout(() => {
            setStep(5);
            const sharedSecret = modPow(
              publicKeyA,
              clientSecretKey,
              primeNumber,
            );
            addLog(`üíé –û–±—á–∏—Å–ª–µ–Ω–æ —Å–ø—ñ–ª—å–Ω–∏–π —Å–µ–∫—Ä–µ—Ç K_AB = Y_A^k_B mod p`);
            addLog(
              `   K_AB = ${publicKeyA}^${clientSecretKey} mod ${primeNumber} = ${sharedSecret}`,
            );
            document.getElementById('shared-secret').textContent = sharedSecret;
            document.getElementById('step-5-formula').innerHTML =
              `K_AB = ${publicKeyA}^${clientSecretKey} mod ${primeNumber}`;
            document.getElementById('step-5-data').innerHTML =
              `K_AB = ${sharedSecret}`;

            document.getElementById('btn-send').disabled = false;
            addLog('‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ Y_B –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É A');
          }, 500);
        }, 500);
      }

      function sendPublicKey() {
        if (!clientPublicKey) {
          alert('‚ùå –°–ø–æ—á–∞—Ç–∫—É –∑–≥–µ–Ω–µ—Ä—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏!');
          return;
        }

        setStep(6);
        addLog('üì§ –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –∫–ª—é—á–∞ Y_B –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É A...');
        addLog(`   Y_B = ${clientPublicKey}`);
        document.getElementById('step-6-data').innerHTML =
          `Y_B = ${clientPublicKey}`;

        socket.emit('sendPublicKeyB', {
          publicKeyB: clientPublicKey,
        });

        document.getElementById('btn-send').disabled = true;
      }

      function modPow(base, exponent, modulus) {
        if (modulus === 1) return 0;
        let result = 1;
        base = base % modulus;
        while (exponent > 0) {
          if (exponent % 2 === 1) {
            result = (result * base) % modulus;
          }
          exponent = Math.floor(exponent / 2);
          base = (base * base) % modulus;
        }
        return result;
      }

      function addLog(message) {
        const logDiv = document.getElementById('log');
        const logItem = document.createElement('div');
        logItem.className = 'log-item';

        const time = new Date().toLocaleTimeString('uk-UA');
        logItem.innerHTML = `<span class="log-time">[${time}]</span>${message}`;

        logDiv.insertBefore(logItem, logDiv.firstChild);
      }

      function toggleSection(id) {
        const element = document.getElementById(id);
        element.classList.toggle('active');
      }

      function generate10Primes() {
        addLog('üî¢ –ó–∞–ø–∏—Ç –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é 10 –ø—Ä–æ—Å—Ç–∏—Ö —á–∏—Å–µ–ª...');
        addLog('‚è≥ –ó–∞—á–µ–∫–∞–π—Ç–µ, –π–¥–µ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —Ç–µ—Å—Ç—É –§–µ—Ä–º–∞ (k=4)...');
        socket.emit('generate10Primes');
      }

      function clearAll() {
        document.getElementById('param-p').textContent = '‚Äî';
        document.getElementById('param-alpha').textContent = '‚Äî';
        document.getElementById('param-ya').textContent = '‚Äî';
        document.getElementById('param-kb').textContent = '‚Äî';
        document.getElementById('param-yb').textContent = '‚Äî';
        document.getElementById('param-attempts').textContent = '‚Äî';
        document.getElementById('shared-secret').textContent = '‚Äî';
        document.getElementById('log').innerHTML = '';
        document.getElementById('verification-result').innerHTML = '';
        document.getElementById('primes-result').innerHTML = '';

        for (let i = 1; i <= 7; i++) {
          document.getElementById(`step-${i}-data`).innerHTML = '';
          if (i === 4 || i === 5) {
            document.getElementById(`step-${i}-formula`).innerHTML = '';
          }
        }

        document.getElementById('btn-init').disabled = false;
        document.getElementById('btn-send').disabled = true;
        serverParams = null;
        clientSecretKey = null;
        clientPublicKey = null;
        setStep(1);
        addLog('üóëÔ∏è –í—Å—ñ –¥–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ');
      }

      window.onload = () => {
        connectToServer();
        addLog('üöÄ –î–æ–¥–∞—Ç–æ–∫ –∑–∞–ø—É—â–µ–Ω–æ');
      };
    </script>
  </body>
</html>
